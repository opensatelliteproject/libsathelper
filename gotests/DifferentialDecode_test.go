package SatHelper

import (
	"github.com/opensatelliteproject/libsathelper"
	"testing"
)

const DifferentialDecodeTestSize = 160

var encodedTestData = []byte{
	0x67, 0xb0, 0x41, 0xa7, 0xc0, 0x4e, 0x5d, 0xc0, 0x41, 0xc0, 0x58, 0x46, 0x5d, 0xa7, 0xc0, 0x5c,
	0x4a, 0x59, 0xa7, 0xb1, 0xb4, 0x46, 0x3f, 0xb5, 0xbb, 0xc0, 0x48, 0x4e, 0x43, 0x9d, 0xbe, 0x58,
	0x70, 0x46, 0x48, 0x5f, 0xb9, 0xa3, 0xcb, 0xf3, 0x98, 0x4f, 0xbe, 0x58, 0x3f, 0xb1, 0xa2, 0x3f,
	0xbe, 0x3f, 0xa7, 0xb9, 0xa2, 0x58, 0x3f, 0xa3, 0xb5, 0xa6, 0x58, 0x4e, 0x4b, 0xb9, 0xc0, 0x4a,
	0x44, 0x3f, 0xb7, 0xb1, 0xbc, 0x62, 0x41, 0xa7, 0x8f, 0xb9, 0xb7, 0xa0, 0x46, 0x5c, 0x34, 0x0c,
	0x67, 0xb0, 0x41, 0xa7, 0xc0, 0x4e, 0x5d, 0xc0, 0x41, 0xc0, 0x58, 0x46, 0x5d, 0xa7, 0xc0, 0x5c,
	0x4a, 0x59, 0xa7, 0xb1, 0xb4, 0x46, 0x3f, 0xb5, 0xbb, 0xc0, 0x48, 0x4e, 0x43, 0x9d, 0xbe, 0x58,
	0x70, 0x46, 0x48, 0x5f, 0xb9, 0xa3, 0xcb, 0xf3, 0x98, 0x4f, 0xbe, 0x58, 0x3f, 0xb1, 0xa2, 0x3f,
	0xbe, 0x3f, 0xa7, 0xb9, 0xa2, 0x58, 0x3f, 0xa3, 0xb5, 0xa6, 0x58, 0x4e, 0x4b, 0xb9, 0xc0, 0x4a,
	0x44, 0x3f, 0xb7, 0xb1, 0xbc, 0x62, 0x41, 0xa7, 0x8f, 0xb9, 0xb7, 0xa0, 0x46, 0x5c, 0x34, 0x0c,
}

var decodedTestData = []byte("That is a test routine of libSatHelper.\nThat is a test routine of libSatHelper.\nThat is a test routine of libSatHelper.\nThat is a test routine of libSatHelper.\n")

func TestDifferentialDecode(t *testing.T) {
	data := make([]byte, DifferentialDecodeTestSize)
	copy(data, encodedTestData)
	SatHelper.DifferentialEncodingNrzmDecode(&data[0], DifferentialDecodeTestSize)
	offset := compareByteArray(data, decodedTestData, DifferentialDecodeTestSize)
	if offset != -1 {
		t.Errorf("  | Differential Encoding Error at test data pos %d. Expected %d got %d ", offset, decodedTestData[offset], data[offset])
	}
}
